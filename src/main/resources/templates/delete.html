<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script type="text/javascript"
            src="webjars/jquery/2.2.4/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#dtBasicExample').DataTable();
            $('.dataTables_length').addClass('bs-select');
        });
    </script>


<body>

<div class="container">
        <form id="addbook-form">
            <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="50%">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Prise</th>
                    <th>Description</th>
                    <th>Date Of Publication</th>
                    <th>Authors</th>
                    <th>Add to card</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="book, rowStat: ${books}">
                    <td th:text="${book.id}"id="id" class="id"></td>
                    <td th:text="${book.name}"></td>
                    <td th:text="${book.price}" id="price" class="price"></td>
                    <td th:text="${book.description}" id="description" class="description"></td>
                    <td th:text="${book.yearOfPublication}" id="yearOfPublication" class="yearOfPublication"></td>
                    <td th:text="${book.namedListOfAuthors()}">
                    <td style="text-align: center;"><a href="#" id="deletebook" class="btn btn-danger btn-md" >delete</a></td>
                    </td>
                </tr>

                </tbody>
                <tfoot>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Prise</th>
                    <th>Description</th>
                    <th>Date Of Publication</th>
                    <th>Authors</th>
                    <th>Add to card</th>
                </tr>
                </tfoot>
            </table>

        </form>

</div>

<script>
    $("a#deletebook").click(function(e){
        e.preventDefault();

        var $row = $(this).closest("tr");    // Find the row
        var $text = $row.find(".id").text();
        var _data = {};
        //todo refactor when will added multiusers
        _data["customerId"] = 1;
        _data["bookId"] = $text;
        $("#btn-add").prop("disabled", true);

        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/deleteBook",
            data: JSON.stringify(_data),
            dataType: 'json',
            cache: false,
            timeout: 600000,
            success: function (data) {

                var json = "";
                $('#result').html(json);

                console.log("SUCCESS : ", data);
                $("#btn-add").prop("disabled", false);
                location.reload();

            },
            error: function (e) {

                var json = e.responseText;
                $('#result').html(json);
                console.log("ERROR : ", e);
                $("#btn-add").prop("disabled", false);

            }
        });

    });
</script>
    <script type="text/javascript"
            src="webjars/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript" src="js/readerView.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>

</div>
</body>
</html>